---
title: "Repot"
author: "Zihan Lin"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lubridate)
library(ggplot2)
library(lubridate)
library(knitr)
```

## Motivation

Extreme weather is on the rise due to climate change, with many, especially those who come from a lower socioeconomic background, already feeling the adverse effects changing weather patterns. Asthma is a co-morbidity for other chronic diseases and also disproportionately affects those from a lower economic status. In this project, we want to focus on asthma prevalence/incidence as hotter temperatures can lead to more pollen, air pollution, and other lung irritants. Studying these trends will help understand the health risks in vulnerable populations.

Key Questions:                                                                                                                                
1. How do asthma cases correlate with temperature extremes?                                                                                   
2. Are there temporal or spatial patterns in asthma prevalence?

## Data

To retrieve the temperature data, different options were explored from within the rnoaa package. meteo_pull_monitors() was first explored, but due to the number of monitors from each state, it was not realistic to pull data from each monitor to calculate the average temperature over a 10-year period. ncdc() was then investigated for use. This uses the National Climatic Data Center to access weather data and already has a TAVG variable for the average temperature. However, there were limitations as it could only gather data one year at a time and there was also issues with the API of this site. Using online resources was not realistic as datasets online were typically separated by year/month/day so getting a seasonal average was not possible. In the end, the temperature data was extracted using meteo_pull_monitors(). 30 monitors from each state were randomly selected and the daily mean of each station was found by averaging the minimum and maximum temperatures (the TAVG as reported by meteo_pull_monitors() could not be used as many stations were missing this data) for every day from 1/1/2011 to 12/31/2021 in every state. The data was then grouped by state, year, and season to find the seasonal average for every state in every year. 

```{r}
# Load datasets
asthma_data <- read_csv("data/asthma_data.csv")
temp_data <- read_csv("data/temp_data.csv")
```

The analysis uses two primary datasets: Asthma Data and Temperature Data. The Asthma Data consists of `r nrow(asthma_data)` observations and `r ncol(asthma_data)` variables, which include details such as the date of record, the region, and the number of asthma cases reported (cases). A brief look at the first few rows reveals the following column names: `r paste(colnames(asthma_data)[1:5], collapse = ", ")`, providing an overview of the key information captured.

The Temperature Data contains `r nrow(temp_data)` observations and `r ncol(temp_data)` variables, with key columns including the date of the temperature reading (date), the region (region), and the recorded temperature (temp). This dataset provides critical environmental context for analyzing the relationship between temperature and asthma cases. 

## Exploratory Data Analysis
```{r}
# Summary of asthma data
asthma_summary <- asthma_data %>%
  summarize(
    avg_prevalence = mean(prevalence_percent, na.rm = TRUE),
    min_prevalence = min(prevalence_percent, na.rm = TRUE),
    max_prevalence = max(prevalence_percent, na.rm = TRUE)
  )

# Create a tidy table for asthma summary using kable
asthma_summary %>%
  knitr::kable(
    col.names = c("Average Prevalence (%)", "Minimum Prevalence (%)", "Maximum Prevalence (%)"),
    caption = "Summary Statistics for Asthma Prevalence"
  )

asthma_summary
```
The average prevalence of asthma across the dataset is approximately 9.42%. The minimum prevalence is 6.2%, while the maximum prevalence is 13.2%. This range suggests notable variability in asthma prevalence across regions or time periods.
```{r}
# Summary of temperature data
temp_summary <- temp_data %>%
  summarize(
    avg_temp_overall = mean(avg_temp, na.rm = TRUE),
    min_temp = min(avg_temp, na.rm = TRUE),
    max_temp = max(avg_temp, na.rm = TRUE)
  )

# Create a tidy table for temperature summary
temp_summary %>%
  knitr::kable(
    col.names = c("Average Temperature (°C)", "Minimum Temperature (°C)", "Maximum Temperature (°C)"),
    caption = "Summary Statistics for Temperature Data"
  )

temp_summary
```
The overall average temperature is approximately 11.88°C, with a wide range from -14.0°C (minimum) to 30.26°C (maximum). The large temperature range indicates that the dataset spans multiple regions with diverse climates.
```{r}
# Average temperature by year
yearly_temp_summary <- temp_data %>%
  group_by(year) %>%
  summarize(
    avg_temp = mean(avg_temp, na.rm = TRUE)
  )

# Create a tidy table for yearly temperature summary
yearly_temp_summary %>%
  knitr::kable(
    col.names = c("Year", "Average Temperature (°C)"),
    caption = "Average Temperature by Year"
  )

yearly_temp_summary
```

```{r}
ggplot(yearly_temp_summary, aes(x = year, y = avg_temp)) +
  geom_line(color = "blue") +
  labs(
    title = "Average Temperature Over Time",
    x = "Year",
    y = "Average Temperature (°C)"
  )
```
The line plot shows annual average temperatures over the years. There are visible fluctuations, with some years showing higher average temperatures (e.g., 2012) and others lower (e.g., 2014). The average temperature peaked around 2012 and dipped notably around 2013-2014. There is no clear upward or downward trend in the dataset; instead, temperatures appear cyclical or influenced by short-term climate variations.

```{r}
# Average temperature by season
seasonal_temp_summary <- temp_data %>%
  group_by(season) %>%
  summarize(
    avg_temp = mean(avg_temp, na.rm = TRUE)
  )

# Create a tidy table for seasonal temperature summary
seasonal_temp_summary %>%
  knitr::kable(
    col.names = c("Season", "Average Temperature (°C)"),
    caption = "Average Temperature by Season"
  )

seasonal_temp_summary
```

```{r}
ggplot(seasonal_temp_summary, aes(x = season, y = avg_temp, fill = season)) +
  geom_bar(stat = "identity") +
  labs(
    title = "Average Temperature by Season",
    x = "Season",
    y = "Average Temperature (°C)"
  )
```
The bar plot displays the average temperature for each season. Summer is significantly warmer (22.45°C on average), while Winter is coldest (1.18°C on average). Fall and Spring fall in between. The seasonal temperature differences are as expected, with clear distinctions between warmer and colder periods. The significant gap between Winter and Summer highlights the need to examine whether asthma prevalence increases during colder months due to weather-induced triggers.
```{r}
# Temperature by state
state_temp_summary <- temp_data %>%
  group_by(state) %>%
  summarize(
    avg_temp = mean(avg_temp, na.rm = TRUE)
  )

ggplot(state_temp_summary, aes(x = reorder(state, -avg_temp), y = avg_temp)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  coord_flip() +
  labs(
    title = "Average Temperature by State",
    x = "State",
    y = "Average Temperature (°C)"
  )
```
The horizontal bar plot ranks states by their average temperature. States on the left (e.g., colder climates) have lower average temperatures, while those on the right (e.g., warmer climates) have higher averages. There is substantial geographic variation in average temperatures across states. States like Alaska are likely on the colder end, while southern states such as Florida or Texas may be on the warmer end.
