<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Asthma Data</title>

<script src="site_libs/header-attrs-2.28/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-6.4.2/css/all.min.css" rel="stylesheet" />
<link href="site_libs/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Home</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="about.html">About</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Data Import
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="temp_function.html">Temperature Data</a>
    </li>
    <li>
      <a href="asthma_function.html">Asthma Data</a>
    </li>
  </ul>
</li>
<li>
  <a href="regression.html">Regression Analysis</a>
</li>
<li>
  <a href="mapping.html">Data Visualization/ EDA</a>
</li>
<li>
  <a href="https://klopez67.shinyapps.io/final_draft/">Shiny</a>
</li>
<li>
  <a href="report.html">Report</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-envelope fa-lg"></span>
     
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="mailto:&lt;hc3563@cumc.columbia.edu&gt;">Hanchuan Chen</a>
    </li>
    <li>
      <a href="mailto:&lt;tpd2121@cumc.columbia.edu&gt;">Tasya Dita</a>
    </li>
    <li>
      <a href="mailto:&lt;zl3543@cumc.columbia.edu&gt;">Zihan Lin</a>
    </li>
    <li>
      <a href="mailto:&lt;am6592@cumc.columbia.edu&gt;">Adeena Moghni</a>
    </li>
    <li>
      <a href="mailto:&lt;kp2809@cumc.columbia.edu&gt;">Kimberly Palaguachi-Lopez</a>
    </li>
  </ul>
</li>
<li>
  <a href="https://github.com/zzihanlin/p8105_final_project.git">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Asthma Data</h1>

</div>


<p>For maps and figures on weather trends, please refer to the <a
href="https://klopez67.shinyapps.io/final_draft/">maps page.</a></p>
<div id="asthma-dataset" class="section level2">
<h2>Asthma dataset</h2>
<p>The asthma dataset was obtained from the
<a href="https://www.cdc.gov/asthma/brfss/default.htm">CDC Behavioral
Risk Factor Surveillance System (BRFSS)</a> data. While initially we
wanted to use data from 2001 to 2021, there was a change in weighting
method in 2011 that made data collected from the previous period
incomparable with data collected 2011 onwards. Therefore, for this
analysis, we only use data from 2011 to 2021 (the most recent year
available) period.</p>
<p>For the dataset, our group use the current asthma prevalence (C)
tables rather than lifetime prevalence as it captures active asthma
cases during the data collection period. We also only keep relevant
variables (state, race, income) and use prevalence percent rather than
prevalence numbers as it better capture the different sample size each
state had. Finally, we only cover the 50 states and excluding
territories (PR, VI, and GU).</p>
During the data scraping and cleaning process, we found several
inconsistencies between year such as:
<ul>
<li>
Different column name, for example, starting from 2016, the column for
“prevalence number” in C1 data change to “weighted number”. For race
data, in 2020, race designation is in column raceg while in 2021, the
data is put in column race_ethnicitygcolumn.
</li>
<li>
Missing states in several years. In 2019, the prevalence data did not
include NJ while in 2021 it did not include FL.
</li>
<li>
Superscript that is included as part of the data: For the race data, the
total prevalence is listed as “U.S. totalf” in 2020 and 2021, rather
than the usual “U.S. total” due to the “f” superscript.
</li>
</ul>
<p>All of these disrepancies are solved during the cleaning process.</p>
<h4>
Prevalence data
</h4>
<p>We made the function to obtain the prevalence data as they are
located at different links.</p>
<pre class="r"><code>asthma_hmtl = function(url) {
  
  df = 
    read_html(url) %&gt;% 
    html_table() %&gt;% 
    bind_rows() %&gt;% 
    janitor::clean_names() %&gt;% 
    select(1:4) %&gt;% 
    mutate(standard_error = as.numeric(standard_error)) %&gt;% 
    filter(!state %in% c(&quot;U.S. Total**&quot;, &quot;U.S. Totalf&quot;, &quot;Territories&quot;, &quot;PR&quot;, &quot;GU&quot;, &quot;VI&quot;)) %&gt;% 
    mutate(prevalence_percent = as.numeric(prevalence_percent))
}</code></pre>
<p><b>Prevalence data</b></p>
<pre class="r"><code>#prevalence
asthma_prevalence = 
  tibble(
    year_name = 2011:2021,
    data_url = c(
    &quot;https://www.cdc.gov/asthma/brfss/2011/tableC1.htm&quot;,
    &quot;https://www.cdc.gov/asthma/brfss/2012/tableC1.htm&quot;, 
    &quot;https://www.cdc.gov/asthma/brfss/2013/tableC1.htm&quot;,
    &quot;https://www.cdc.gov/asthma/brfss/2014/tableC1.htm&quot;,
    &quot;https://www.cdc.gov/asthma/brfss/2015/tableC1.htm&quot;,
    &quot;https://www.cdc.gov/asthma/brfss/2016/tableC1.htm&quot;,
    &quot;https://www.cdc.gov/asthma/brfss/2017/tableC1.htm&quot;,
    &quot;https://www.cdc.gov/asthma/brfss/2018/tableC1.html&quot;,
    &quot;https://www.cdc.gov/asthma/brfss/2019/tableC1.html&quot;,
    &quot;https://www.cdc.gov/asthma/brfss/2020/tableC1.html&quot;,
    &quot;https://www.cdc.gov/asthma/brfss/2021/tableC1.html&quot;)
  ) %&gt;% 
  mutate(asthma_byyear = map(data_url, asthma_hmtl)) %&gt;% 
  unnest(asthma_byyear) %&gt;% 
  select(-data_url, -sample_size, -sample_sizec, -standard_error) %&gt;% 
  group_by(year_name)

asthma_prevalence %&gt;% 
  mutate(year_name = as.factor(year_name)) %&gt;% 
  ggplot(aes(x = year_name, y = prevalence_percent)) + 
  geom_boxplot(aes(fill = year_name), color = &quot;blue&quot;, alpha = .5) + 
  labs(
    x = &quot;Year&quot;,
    y = &quot;Prevalence_percent&quot;,
    title = &quot;Asthma cases by year&quot;
  ) +
  theme_minimal()</code></pre>
<p><img src="asthma_function_files/figure-html/asthma%20prevalence-1.png" width="672" /></p>
<pre class="r"><code>asthma_prevalence %&gt;% 
  ggplot(aes(x = state, y = prevalence_percent)) + 
  geom_boxplot() + 
  labs(
    x = &quot;State&quot;,
    y = &quot;Prevalence_percent&quot;,
    title = &quot;Asthma cases by state&quot;
  ) +
  theme_minimal()</code></pre>
<p><img src="asthma_function_files/figure-html/asthma%20prevalence-2.png" width="672" /></p>
<p>Looking at the annual trend, we see that asthma prevalence show a
slightly increasing trend since 2014. Looking at the states data, the
highest prevalence are found in RI, ME, KY, WV and VT while the lowest
prevalence are found in TX, FL, NE, LA, SD.</p>
<h4>
Race and income data
</h4>
<p>New function was developed to scrape race and income data as they had
additional columns.</p>
<pre class="r"><code>#function 2 for race and income data
asthma_hmtl2 = function(url) {
  
  df = 
    read_html(url) %&gt;% 
    html_table() %&gt;% 
    bind_rows() %&gt;% 
    janitor::clean_names() %&gt;% 
    select(1:4) %&gt;% 
    filter(!state %in% c(&quot;U.S. Total**&quot;, &quot;U.S. Totalf&quot;, &quot;Territories&quot;, &quot;PR&quot;, &quot;GU&quot;, &quot;VI&quot;)) %&gt;% 
    mutate(prevalence_percent = as.numeric(prevalence_percent))
}</code></pre>
<p><b>Race</b> For race data, since 2021 the survey collected race and
ethinicity data, so the categories are slightly different. We keep the
new terms, however we merged “multi” and “multirace” as the same
category to help simplify the category available.</p>
<pre class="r"><code>asthma_prace = 
  tibble(
    year_name = 2011:2021,
    data_url = c(
    &quot;https://www.cdc.gov/asthma/brfss/2011/tableC4.htm&quot;,
    &quot;https://www.cdc.gov/asthma/brfss/2012/tableC4.htm&quot;, 
    &quot;https://www.cdc.gov/asthma/brfss/2013/tableC4.htm&quot;,
    &quot;https://www.cdc.gov/asthma/brfss/2014/tableC4.htm&quot;,
    &quot;https://www.cdc.gov/asthma/brfss/2015/tableC4.htm&quot;,
    &quot;https://www.cdc.gov/asthma/brfss/2016/tableC4.htm&quot;,
    &quot;https://www.cdc.gov/asthma/brfss/2017/tableC4.htm&quot;,
    &quot;https://www.cdc.gov/asthma/brfss/2018/tableC4.html&quot;,
    &quot;https://www.cdc.gov/asthma/brfss/2019/tableC4.html&quot;,
    &quot;https://www.cdc.gov/asthma/brfss/2020/tableC4.html&quot;,
    &quot;https://www.cdc.gov/asthma/brfss/2021/tableC4.html&quot;)
  ) %&gt;% 
  mutate(asthma_byyear = map(data_url, asthma_hmtl2)) %&gt;% 
  unnest(asthma_byyear)

asthma_prace = asthma_prace %&gt;% 
  select(-data_url, -sample_size, -sample_sizec) %&gt;% 
  mutate(
    race = ifelse(is.na(race), raceg, race), 
    race = ifelse(is.na(race), race_ethnicityg, race), 
    race = case_when(race == &quot;Multi&quot; ~ &quot;Multirace&quot;, TRUE ~ race)
    ) %&gt;% 
  select(-raceg, -race_ethnicityg)

asthma_prace %&gt;% 
  ggplot(aes(x = year_name, y = prevalence_percent, color = race)) + 
  geom_boxplot() + 
  facet_wrap(~ race) +
  labs(
    x = &quot;Year&quot;,
    y = &quot;Prevalence_percent&quot;,
    title = &quot;Asthma prevalence by year by race &amp; ethnicity&quot;
  ) +
  theme_minimal()</code></pre>
<p><img src="asthma_function_files/figure-html/race-1.png" width="672" /></p>
<p>People identified as Black and Multirace have higher asthma
prevalence distribution compared to the other groups, while While and
White NH have the lowest. This suggest that asthma may be correlated
with race, which will be investigated further in the analysis.</p>
<pre class="r"><code>asthma_prace = asthma_prace %&gt;%
  nest(race, prevalence_percent)</code></pre>
<p><b>Income data</b> For the income data, in 2020 they used “-” instead
of “–” and in 2021 they changed the upper limit in the range to
&lt;$25,000, $50,000 and $75,000 (instead of $24,999, $49,999 and
$74,000). We merged the data by mutating the dash and the
categories.</p>
<pre class="r"><code>asthma_pincome = 
  tibble(
    year_name = 2011:2021,
    data_url = c(
    &quot;https://www.cdc.gov/asthma/brfss/2011/tableC7.htm&quot;,
    &quot;https://www.cdc.gov/asthma/brfss/2012/tableC7.htm&quot;, 
    &quot;https://www.cdc.gov/asthma/brfss/2013/tableC7.htm&quot;,
    &quot;https://www.cdc.gov/asthma/brfss/2014/tableC7.htm&quot;,
    &quot;https://www.cdc.gov/asthma/brfss/2015/tableC7.htm&quot;,
    &quot;https://www.cdc.gov/asthma/brfss/2016/tableC7.htm&quot;,
    &quot;https://www.cdc.gov/asthma/brfss/2017/tableC7.htm&quot;,
    &quot;https://www.cdc.gov/asthma/brfss/2018/tableC7.html&quot;,
    &quot;https://www.cdc.gov/asthma/brfss/2019/tableC7.html&quot;,
    &quot;https://www.cdc.gov/asthma/brfss/2020/tableC7.html&quot;,
    &quot;https://www.cdc.gov/asthma/brfss/2021/tableC6.html&quot;)
  ) %&gt;% 
  mutate(asthma_byyear = map(data_url, asthma_hmtl2)) %&gt;% 
  unnest(asthma_byyear) %&gt;% 
  select(-data_url, -sample_size, -sample_sizec) %&gt;% 
  mutate(
    income = case_when(income == &quot;$15-$24,999&quot; ~ &quot;$15–$24,999&quot;, TRUE ~ income),
    income = case_when(income == &quot;$15,000–&lt;$25,000&quot; ~ &quot;$15–$24,999&quot;, TRUE ~ income),
    income = case_when(income == &quot;$25-$49,999&quot; ~ &quot;$25–$49,999&quot;, TRUE ~ income),
    income = case_when(income == &quot;$25,000–&lt;$50,000&quot; ~ &quot;$25–$49,999&quot;, TRUE ~ income),
    income = case_when(income == &quot;$50-$74,999&quot; ~ &quot;$50–$74,999&quot;, TRUE ~ income), 
    income = case_when(income == &quot;$50,000–&lt;$75,000&quot; ~ &quot;$50–$74,999&quot;, TRUE ~ income)
    )

asthma_pincome %&gt;% 
  ggplot(aes(x = year_name, y = prevalence_percent, color = income)) + 
  geom_point(alpha = 0.5) +
  labs(
    x = &quot;Year&quot;,
    y = &quot;Prevalence_percent&quot;,
    title = &quot;Asthma prevalence by year by income&quot;
  ) +
  theme_minimal()</code></pre>
<p><img src="asthma_function_files/figure-html/income-1.png" width="672" /></p>
<p>People in the lowest income level (&lt;$15,000) has the highest
asthma prevalence across all years while people in the highest income
level (&gt;=$75,000) has the lowest prevalence. This suggest that asthma
is correlated with income, which will be investigated further in the
analysis.</p>
<pre class="r"><code>asthma_pincome = asthma_pincome %&gt;% 
  nest(income, prevalence_percent)</code></pre>
<h4>
Complete dataset
</h4>
<p>For the final dataset that we are using in the analysis, we combine
the state prevalence, race and income data into 1 dataframe. We put the
race and income into a listcol as they are stratified in each state.</p>
<pre class="r"><code>#asthma dataset
asthma_dataset = 
  inner_join(asthma_prevalence, asthma_prace, by = c(&quot;year_name&quot;, &quot;state&quot;)) %&gt;% 
  inner_join(asthma_pincome, by = c(&quot;year_name&quot;, &quot;state&quot;)) %&gt;% 
  janitor::clean_names() %&gt;% 
  rename(&quot;race&quot; = &quot;data_x&quot;, &quot;income&quot; = &quot;data_y&quot;)</code></pre>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
